server {
   server_name rsize.lc
   add_header Access-Control-Allow-Origin '*';

   location ~ ^/([^:/]+):([^/]+)/([^/]+)/(.*)$
   {
      set $var_host $3;
      resolver 1.1.1.1 8.8.8.8 ipv6=off;

      proxy_pass https://$var_host/$4$is_args$args;
      proxy_ssl_server_name on;
      proxy_read_timeout 10s;
      proxy_http_version 1.1;
      proxy_hide_header 'Access-Control-Allow-Origin';
      proxy_set_header User-Agent 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/77.0.3865.120 Safari/537.36';
      proxy_redirect ~^https?://(.+)$ /$1;
      proxy_max_temp_file_size 0;

      image_filter resize $1 $2;
      #image_filter_jpeg_quality 85;
      image_filter_buffer 4M;
   }

   location ~ ^/crop/([^:/]+):([^/]+)/([^/]+)/(.*)$
   {
      set $var_host $3;
      resolver 1.1.1.1 8.8.8.8 ipv6=off;

      proxy_pass https://$var_host/$4$is_args$args;
      proxy_ssl_server_name on;
      proxy_read_timeout 10s;
      proxy_http_version 1.1;
      proxy_hide_header 'Access-Control-Allow-Origin';
      proxy_set_header User-Agent 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/77.0.3865.120 Safari/537.36';
      proxy_redirect ~^https?://(.+)$ /$1;
      proxy_max_temp_file_size 0;

      image_filter crop $1 $2;
      #image_filter_jpeg_quality 85;
      image_filter_buffer 4M;
   }
}
